{"version":3,"sources":["field.js"],"names":["COCKROACH","EMPTY","CAN_T_MOVE_WALL","Field","fieldStr","fld","split","last","lineWidth","length","i","testline","idx","indexOf","pos","char","j","charAt","lsnr","line","test","from_i","from_j","to_i","to_j","move","idelta","jdelta","res","Promise","resolve","move0","toUp","console","log","toString","possiblyEmpty","join"],"mappings":"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","file":"field.6bf66d2b.js","sourceRoot":"..","sourcesContent":["export const COCKROACH = '~';\nexport const EMPTY = '_';\nvar CAN_T_MOVE_WALL = 'Не могу!';\n\nexport class Field {\n    constructor(fieldStr) {\n        this.fld = fieldStr.split(/\\r?\\n/);\n        this.last = EMPTY;\n\n        var lineWidth = this.fld[0].length;\n\n        for (var i=0; i<this.fld.length; i++) {\n            if (lineWidth != this.fld[i].length)\n                throw 'Lines has different length';\n            \n            if (!this.testline(this.fld[i]))\n                throw 'Line has wrong format['+ this.fld[i] + ']';\n\n            this.fld[i] = this.fld[i].split('');\n\n            var idx = this.fld[i].indexOf(COCKROACH);\n            if (idx == -1)\n                continue;\n\n            if (this.pos)\n                throw 'Double cockroach position!';\n\n            this.pos = [i, idx];\n        }\n    }\n\n    set(char, i, j) {\n        if (this.pos[0] == i && this.pos[1] == j)\n            return;\n        \n        this.fld[i][j] = char.charAt(0);\n\n        if (this.lsnr)\n            this.lsnr();\n    }\n\n    testline(line) {\n        return /^[A-Za-zА-Яа-я0-9_~]+$/.test(line);\n    }\n\n    change(from_i, from_j, to_i, to_j) {\n        if (this.pos[0] == to_i && this.pos[1] == to_j)\n            return;\n\n        if (this.pos[0] == from_i && this.pos[1] == from_j)\n            this.pos = [to_i, to_j];\n\n        this.fld[to_i][to_j] = this.fld[from_i][from_j];\n        this.fld[from_i][from_j] = EMPTY;\n\n        if (this.lsnr)\n            this.lsnr();\n    }\n\n    up() {\n        return this.move(-1, 0);\n    }\n\n    down() {\n        return this.move(1, 0);\n    }\n\n    left() {\n        return this.move(0, -1);\n    }\n\n    right() {\n        return this.move(0, 1);\n    }\n\n    stay() {\n        return this.move(0, 0);\n    }\n\n    move(idelta, jdelta) {\n        var res = Promise.resolve();\n\n        if (this.lsnr)\n            res = this.lsnr();\n\n        if (idelta == 0 && jdelta == 0) \n            return res;\n\n        this.last = this.move0(COCKROACH, this.pos[0], this.pos[1], idelta, jdelta);\n\n        this.pos[0] += idelta;\n        this.pos[1] += jdelta;\n\n        return res;\n    }\n\n    move0(toUp, i, j, idelta, jdelta) {\n        if (i + idelta < 0 || i + idelta >= this.fld.length) {\n            console.log(this.toString());\n            throw CAN_T_MOVE_WALL;\n        }\n\n        if (j + jdelta < 0 || j + jdelta >= this.fld[0].length)  {\n            console.log(this.toString());\n            throw CAN_T_MOVE_WALL;\n        }\n\n        var possiblyEmpty = this.fld[i + idelta][j + jdelta];\n\n        if (possiblyEmpty != EMPTY)\n            this.move0(possiblyEmpty, i + idelta, j + jdelta, idelta, jdelta);\n\n        this.fld[i][j] = EMPTY;\n        this.fld[i + idelta][j + jdelta] = toUp;\n\n        return possiblyEmpty;\n    }\n\n    onChange(lsnr) {\n        this.lsnr = lsnr;\n\n        this.lsnr();\n    }\n\n    toString() {\n        var res = \"\";\n\n        for (var i=0; i<this.fld.length; i++) {\n            if (i != 0)\n                res += \"\\n\";\n            res += this.fld[i].join(\"\");\n        }\n\n        return res;\n    }\n\n    width() {\n        return this.fld[0].length;\n    }\n\n    height() {\n        return this.fld.length;\n    }\n}"]}